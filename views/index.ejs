<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <link rel="manifest" href="manifest.json"/>
</head>
<body>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-messaging.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyClNFoKocaycrGI42gTaBcYINw0d55t--4",
        authDomain: "fcm-node-test-a9b79.firebaseapp.com",
        databaseURL: "https://fcm-node-test-a9b79.firebaseio.com",
        projectId: "fcm-node-test-a9b79",
        storageBucket: "fcm-node-test-a9b79.appspot.com",
        messagingSenderId: "1015332584005",
        appId: "1:1015332584005:web:ca3292d06cd4b5bcf9012c",
        measurementId: "G-3EJ6VQC9J1"
    };
    firebase.initializeApp(config);

    const messaging = firebase.messaging();

    //token 값 알아내기
    messaging.requestPermission()
        .then(function(){
            return messaging.getToken();
        })
        .then(function(token){
            console.log('token : ' + token);
            $('#_token').html(token);
        })
        .catch(function(arr){
            console.log("Error Occured");
            console.log(arr);
        });

    messaging.onMessage(function(payload) {
        console.log("onMessage: ", payload);
        navigator.serviceWorker.getRegistration('/sw.js').then(registration => {
            registration.showNotification(
                payload.notification
            )
        });
    });

</script>
<script>
    if ('serviceWorker' in navigator && 'PushManager' in window) {
        console.log('Service Worker and Push is supported');

        navigator.serviceWorker.register('/sw.js')
            .then(function(swReg) {
                console.log('Service Worker is registered', swReg);

                swRegistration = swReg;
            })
            .catch(function(error) {
                console.error('Service Worker Error', error);
            });
    } else {
        console.warn('Push messaging is not supported');
        pushButton.textContent = 'Push Not Supported';
    }

</script>
<span id='_token'></span>
</body>
</html>